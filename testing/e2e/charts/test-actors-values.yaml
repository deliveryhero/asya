# E2E test actors configuration for asya-actor chart
# This file defines all test actors for E2E testing

namespace: asya-e2e
transport: sqs


# Default configuration applied to all test actors
default:
  # Default scaling configuration inherited by all actors
  scaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 10
    pollingInterval: 10
    cooldownPeriod: 60
    queueLength: 5

  # Default workload configuration
  workload:
    kind: Deployment
    template:
      spec:
        containers:
        - name: asya-runtime
          image: asya-testing:latest
          imagePullPolicy: IfNotPresent

  # Health checks configuration for multi-actor deployment
  # All health checks disabled - multi-actor mode is for E2E testing
  # where validation happens via pytest test cases
  healthChecks:
    preInstall:
      enabled: false
    crew:
      enabled: false
    queue:
      enabled: false
    deployment:
      enabled: false
    status:
      enabled: false

# List of test actors
# Each actor specifies its full workload to ensure proper merging
actors:
- name: test-echo
  workload:
    kind: Deployment
    template:
      spec:
        containers:
        - name: asya-runtime
          image: asya-testing:latest
          imagePullPolicy: IfNotPresent
          env:
          - name: ASYA_HANDLER
            value: asya_testing.handlers.payload.echo_handler
          - name: ASYA_INCLUDE_ROUTE_INFO
            value: 'true'

- name: test-doubler
  workload:
    kind: Deployment
    template:
      spec:
        containers:
        - name: asya-runtime
          image: asya-testing:latest
          imagePullPolicy: IfNotPresent
          env:
          - name: ASYA_HANDLER
            value: asya_testing.handlers.payload.pipeline_doubler
          - name: ASYA_INCLUDE_ROUTE_INFO
            value: 'true'

- name: test-incrementer
  workload:
    kind: Deployment
    template:
      spec:
        containers:
        - name: asya-runtime
          image: asya-testing:latest
          imagePullPolicy: IfNotPresent
          env:
          - name: ASYA_HANDLER
            value: asya_testing.handlers.payload.pipeline_incrementer
          - name: ASYA_INCLUDE_ROUTE_INFO
            value: 'true'

- name: test-fanout
  workload:
    kind: Deployment
    template:
      spec:
        containers:
        - name: asya-runtime
          image: asya-testing:latest
          imagePullPolicy: IfNotPresent
          env:
          - name: ASYA_HANDLER
            value: asya_testing.handlers.payload.fanout_handler

- name: test-empty
  workload:
    kind: Deployment
    template:
      spec:
        containers:
        - name: asya-runtime
          image: asya-testing:latest
          imagePullPolicy: IfNotPresent
          env:
          - name: ASYA_HANDLER
            value: asya_testing.handlers.payload.empty_response_handler

- name: test-error
  workload:
    kind: Deployment
    template:
      spec:
        containers:
        - name: asya-runtime
          image: asya-testing:latest
          imagePullPolicy: IfNotPresent
          env:
          - name: ASYA_HANDLER
            value: asya_testing.handlers.payload.error_handler

- name: test-timeout
  timeout:
    processing: 5
  workload:
    kind: Deployment
    template:
      spec:
        containers:
        - name: asya-runtime
          image: asya-testing:latest
          imagePullPolicy: IfNotPresent
          env:
          - name: ASYA_HANDLER
            value: asya_testing.handlers.payload.timeout_handler

- name: test-unicode
  workload:
    kind: Deployment
    template:
      spec:
        containers:
        - name: asya-runtime
          image: asya-testing:latest
          imagePullPolicy: IfNotPresent
          env:
          - name: ASYA_HANDLER
            value: asya_testing.handlers.payload.unicode_handler

- name: test-nested
  workload:
    kind: Deployment
    template:
      spec:
        containers:
        - name: asya-runtime
          image: asya-testing:latest
          imagePullPolicy: IfNotPresent
          env:
          - name: ASYA_HANDLER
            value: asya_testing.handlers.payload.nested_data_handler

- name: test-large-payload
  workload:
    kind: Deployment
    template:
      spec:
        containers:
        - name: asya-runtime
          image: asya-testing:latest
          imagePullPolicy: IfNotPresent
          env:
          - name: ASYA_HANDLER
            value: asya_testing.handlers.payload.large_payload_handler

- name: test-slow-boundary
  workload:
    kind: Deployment
    template:
      spec:
        containers:
        - name: asya-runtime
          image: asya-testing:latest
          imagePullPolicy: IfNotPresent
          env:
          - name: ASYA_HANDLER
            value: asya_testing.handlers.payload.slow_then_fast_handler

- &multihop-actor-template
  # Multihop actors (15 actors for testing multi-hop chains)
  # Using YAML anchor to reduce duplication
  name: test-multihop-0
  workload:
    kind: Deployment
    template:
      spec:
        containers:
        - name: asya-runtime
          image: asya-testing:latest
          imagePullPolicy: IfNotPresent
          env:
          - name: ASYA_HANDLER
            value: asya_testing.handlers.payload.multihop_handler
          - name: ASYA_ENABLE_VALIDATION
            value: 'false'

- !!merge <<: *multihop-actor-template
  name: test-multihop-1

- !!merge <<: *multihop-actor-template
  name: test-multihop-2

- !!merge <<: *multihop-actor-template
  name: test-multihop-3

- !!merge <<: *multihop-actor-template
  name: test-multihop-4

- !!merge <<: *multihop-actor-template
  name: test-multihop-5

- !!merge <<: *multihop-actor-template
  name: test-multihop-6

- !!merge <<: *multihop-actor-template
  name: test-multihop-7

- !!merge <<: *multihop-actor-template
  name: test-multihop-8

- !!merge <<: *multihop-actor-template
  name: test-multihop-9

- !!merge <<: *multihop-actor-template
  name: test-multihop-10

- !!merge <<: *multihop-actor-template
  name: test-multihop-11

- !!merge <<: *multihop-actor-template
  name: test-multihop-12

- !!merge <<: *multihop-actor-template
  name: test-multihop-13

- !!merge <<: *multihop-actor-template
  name: test-multihop-14
